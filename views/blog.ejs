<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Blog</title>

    <!-- Dependencies -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.js"
        integrity="sha256-2JRzNxMJiS0aHOJjG+liqsEOuBb6++9cY4dSOyiijX4=" crossorigin="anonymous"></script>

    <!-- Stylesheet reference -->
    <link rel="stylesheet" href="css/blog.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/popup.css">
    <link rel="stylesheet" href="css\glide\blog\glide.core.min.css">
    <link rel="stylesheet" href="css\glide\blog\glide.theme.min.css">
</head>

<header>
    <!-- ------------- NAVIGATION ------------- -->
    <nav class="nav">
        <div class="nav-bar flex-row">

            <div class="nav-brand">

                <a href="http://localhost:3000/">
                    <img class="brand-logo" src="assets/svg/blog.svg" width="50">
                    <span class="brand-brandname">Blog</span>
                </a>
            </div>

            <!-- ------------- Menu used if screen <= 750px  ------------- -->
            <div class="menu">
                <div class="icons">
                    <span>
                        <i class="fas fa-bars"></i>
                    </span>
                </div>
            </div>

            <div>
                <ul class="nav-items">
                    <li class="nav-link" id="link-home">
                        <a href="http://localhost:3000/">Home</a>
                    </li>
                    <li class="nav-link" id="link-about">
                        <a href="http://localhost:3000/about">About</a>
                    </li>
                </ul>
            </div>

            <button data-modal-target="#modal" class="user">
                <i class="fas fa-user-circle"></i>
            </button>
        </div>
    </nav>
</header>
<!-- The Java Script file that controls the navbar-->
<script src="js/navbar.js"></script>

<body>

    <!-- ------------- Login Pop-up  ------------- -->
    <div class="modal" id="modal">

        <button data-modal-close class="btn-login-close">&times;</button>

        <div class="modal-header" id="modal-header">
            <div class="title title-login" id="title-login">Login</div>
            <div class="title title-register" id="title-register">Register</div>
        </div>

        <div class="modal-body">

            <!-- Logged in -->
            <div class="container-logged" id="container-logged">
                <h1 id="welcome">Welcome username!</h1>
                <div>
                    <img src="assets/vectors/user_avatars/001-man.svg" alt="User avatar not found!" width="150px" id="user-avatar">
                </div>
                <button class="popup-btn btn_logout" name="btn_logout" type="button" value="logout" id="btn-logout">
                    Log Out
                </button>
            </div>

            <!-- Error messages -->
            <p class="error" id="err1">small error</p>
            <p class="error" id="err2">You did something very wrong and now it's long</p>
            <p class="error" id="err3">Er</p>
            <p class="error" id="err4">Er</p>

            <!-- Login / Register  -->
            <form class="modal-form" action="${pageContext.request.contextPath}/login" method="post" id="modal-form">

                <div class="form-section form-username">
                    <span class="form-txt txt-username">
                        Username:
                    </span>
                    <input class="txt-in" type="text" name="username" id="username">
                </div>

                <div class="form-section form-password">
                    <span class="form-txt txt-password">
                        Password:
                    </span>
                    <input class="txt-in" type="password" name="password" id="password">
                </div>

                <div class="form-section form-confirm" id="form-confirm">
                    <span class="form-txt txt-confirm">
                        Confirm Password:
                    </span>
                    <input class="txt-in" type="password" name="confirm" id="confirm">
                </div>

                <div class="form-section form-email" id="form-email">
                    <span class="form-txt txt-email">
                        Email:
                    </span>
                    <input class="txt-in" type="email" name="email" id="email">
                </div>

                <button class="popup-btn btn_login_register" name="btn_register" type="button" value="register"
                    id="btn-register">
                    Register
                </button>

                <button class="popup-btn btn_login_login" name="btn_login" type="button" value="login" id="btn-login">
                    Login
                </button>
            </form>
        </div>
    </div>
    <div id="overlay"></div>

    <!-- Popup Script -->
    <script src="js/popup.js" onload="highlightLogin()"></script>

    <!-- Has to be placed AFTER the popup script -->
    <script src="js/login.js"></script>

    <main>

        <section class="site-intro" id="intro">

            <div class="intro-blog">
                <h2>Blog Description</h2>
                <p>This blog consists of projects that Ã–jvind Nilsson and Peter Tenghamn have worked together on while
                    studying in HKR. Some projects were developed in larger groups while some were just us two. We hope
                    you enjoy our blog!</p>
            </div>

            <div class="intro-users">

                <h2>Subscribed Users</h2>
                <div class="container-users">
                </div>
                <!-- The carousel section-->
                <div class="glide">

                    <!-- The contents of the carousel-->
                    <div class="glide__track" data-glide-el="track" id="glide__track_id">
                        <ul class="glide__slides">
                            <li class="glide__slide">
                                <!-- Image could just be saved as the path to the image -->
                                <img src="assets/vectors/user_avatars/001-man.svg" alt="User Avatar">
                                <h3>Username 1</h3>
                            </li>
                            <li class="glide__slide">
                                <img src="assets/vectors/user_avatars/001-man.svg" alt="User Avatar">
                                <h3>Username 2</h3>
                            </li>
                            <li class="glide__slide">
                                <img src="assets/vectors/user_avatars/001-man.svg" alt="User Avatar">
                                <h3>Username 3</h3>
                            </li>
                            <li class="glide__slide">
                                <img src="assets/vectors/user_avatars/001-man.svg" alt="User Avatar">
                                <h3>Username 4</h3>
                            </li>
                        </ul>

                    </div>

                </div>
            </div>

            <!-- Scripts controlling the carousel -->
            <script src="https://cdn.jsdelivr.net/npm/@glidejs/glide"></script>
            <!-- Loading of carousel dependency -->
            <script>
                const config = {
                    type: 'slider',
                    perView: 3,

                    gap: '10',
                    hoverpause: true,
                    autoplay: 2000,
                    peek: {
                        before: 10,
                        after: 10
                    }
                }

                new Glide('.glide', config).mount()
            </script>

        </section>

        <section class="site-content" id="content">
            <!-- Placeholder content to be replaced via DB script -->
            <div class="item">
                <h1>Something Went Wrong</h1>
                <img src="https://www.elegantthemes.com/blog/wp-content/uploads/2020/01/http-error-503-featured-image.jpg"
                    alt="Oops">
                <p>Nothing was received by the database! If you are a user seeing this ignore it and contact us about
                    it! </p>
            </div>
        </section>

        <div class="section-padding"></div>
    </main>
</body>

<!-- JavaScripts that need to be loaded AFTER page load -->
    <script src="js/user.js"></script>

    <!-- Javascript which runs after document is loaded -->
    <script>
        $(document).ready(function () {
            // User Carousel Update from the DB
            function updateCarousel() {
                $.ajax({
                    url: '/users/get',
                    contentType: 'application/json',
                    success: function(response){
                        $("#glide__track_id ul").remove();
                        //Take the response and use it to fill the table
                        var trHTML = '<ul class="glide__slides">';
                        if (response && response.length > 0){
                            <!-- TODO get these from the DB -->
                            <!-- Image could just be saved as the path to the image -->
                            response.forEach(element =>
                                trHTML +=
                                    '<li class="glide__slide">' +
                                    '<img src="assets/vectors/user_avatars/001-man.svg" alt="User Avatar">' +
                                    '<h3>' + element.username + '</h3>' +
                                    '</li>'
                            );
                        }
                        trHTML += '</ul>';
                        $('#glide__track_id').append(trHTML);

                        const config = {
                            type: 'slider',
                            perView: 3,

                            gap: '10',
                            hoverpause: true,
                            autoplay: 2000,
                            peek: {
                                before: 10,
                                after: 10
                            }
                        }

                        new Glide('.glide', config).mount()
                    }
                })
            }

            // Get articles and their base descriptions and a button to read more
            function retrieveArticles() {
                $.ajax({
                    url: '/articles/get',
                    contentType: 'application/json',
                    success: function(response){
                        $("#content").empty();
                        let divHTML = '';
                        //If retrieved successfully, fill content with the articles
                        if (response && response.length > 0){
                            response.forEach(element =>
                                divHTML +=
                                    '<h4>' + element.date + '</h4>' +
                                    '<div class="item">' +
                                    '<img src="/assets/gifs/demo_MapleStory.gif" alt="Demo of Project NOT Loaded">' +
                                    '<h1>' + element.title + '</h1>' +
                                    '<h3>' + element.snippet + '</h3>' +
                                    '<div class="item-buttons">' +
                                    '<a href="http://localhost:3000/post/' + element.article_id + ' class="btn-edit">Read More</a>' +
                                    '</div></div>'
                            );
                        }
                        else
                        {
                            divHTML +=
                                '<div class="item">\n' +
                                '<h1>Something Went Wrong</h1>\n' +
                                '<img src="https://www.elegantthemes.com/blog/wp-content/uploads/2020/01/http-error-503-featured-image.jpg"\n' +
                                'alt="Oops">\n' +
                                '<p>Nothing was received by the database! If you are a user seeing this ignore it and contact us about\n' +
                                'it! </p>\n' +
                                '</div>'
                        }
                        $('#content').append(divHTML);
                    },
                    fail: function () {
                        $("#content").empty();
                        var divHTML =
                            '<div class="item">\n' +
                            '<h1>Something Went Wrong</h1>\n' +
                            '<img src="https://www.elegantthemes.com/blog/wp-content/uploads/2020/01/http-error-503-featured-image.jpg"\n' +
                            'alt="Oops">\n' +
                            '<p>Nothing was received by the database! If you are a user seeing this ignore it and contact us about\n' +
                            'it! </p>\n' +
                            '</div>'
                        $('#content').append(divHTML);
                    }
                });
            }

            updateCarousel();
            retrieveArticles();
        })
    </script>

</html>